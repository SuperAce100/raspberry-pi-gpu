<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QPU Assembler Tool</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>Broadcom VideoCore QPU Assembler</h1>
            <p>Enter QPU assembly instructions to see their binary encoding</p>
        </header>
        
        <div class="assembler-panel">
            <div class="input-section">
                <h2>Assembly Input</h2>
                <div class="instruction-builder">
                    <div class="instruction-type">
                        <label for="instruction-type">Instruction Type:</label>
                        <select id="instruction-type">
                            <option value="alu">ALU Instruction</option>
                            <option value="branch">Branch Instruction</option>
                            <option value="load-immediate">Load Immediate</option>
                            <option value="load">Load/Store Instruction</option>
                        </select>
                    </div>
                    
                    <div id="alu-options" class="instruction-options">
                        <div class="operation-section">
                            <label for="alu-op">Operation:</label>
                            <select id="alu-op">
                                <!-- Integer ALU operations -->
                                <option value="nop">nop</option>
                                <option value="add">add</option>
                                <option value="sub">sub</option>
                                <option value="shr">shr</option>
                                <option value="asr">asr</option>
                                <option value="ror">ror</option>
                                <option value="shl">shl</option>
                                <option value="min">min</option>
                                <option value="max">max</option>
                                <option value="and">and</option>
                                <option value="or">or</option>
                                <option value="xor">xor</option>
                                <option value="not">not</option>
                                <option value="clz">clz</option>
                                <option value="v8adds">v8adds</option>
                                <option value="v8subs">v8subs</option>
                                
                                <!-- Floating-point ALU operations -->
                                <option value="fadd">fadd</option>
                                <option value="fsub">fsub</option>
                                <option value="fmul">fmul</option>
                                <option value="fmin">fmin</option>
                                <option value="fmax">fmax</option>
                                <option value="fminabs">fminabs</option>
                                <option value="fmaxabs">fmaxabs</option>
                                <option value="ftoi">ftoi</option>
                                <option value="itof">itof</option>
                                
                                <!-- Special operations -->
                                <option value="mov">mov</option>
                                <option value="thrend">thrend</option>
                                <option value="thrsw">thrsw</option>
                                
                                <!-- Add load/store instructions section -->
                                <option value="ldvpm">ldvpm</option>
                                <option value="stvpm">stvpm</option>
                                <option value="ldtmu0">ldtmu0</option>
                                <option value="ldtmu1">ldtmu1</option>
                                <option value="lduniform">lduniform</option>
                                <option value="ldvary">ldvary</option>
                            </select>
                        </div>
                        
                        <div class="register-section">
                            <div class="destination">
                                <label for="dst-reg">Destination:</label>
                                <select id="dst-reg">
                                    <option value="r0">r0</option>
                                    <option value="r1">r1</option>
                                    <option value="r2">r2</option>
                                    <option value="r3">r3</option>
                                    <option value="r4">r4</option>
                                    <option value="r5">r5</option>
                                    <option value="r6">r6</option>
                                    <option value="r7">r7</option>
                                    <option value="r8">r8</option>
                                    <option value="r9">r9</option>
                                    <option value="r10">r10</option>
                                    <option value="r11">r11</option>
                                    <option value="r12">r12</option>
                                    <option value="r13">r13</option>
                                    <option value="r14">r14</option>
                                    <option value="r15">r15</option>
                                    <option value="vpm">vpm</option>
                                    <option value="null">null</option>
                                </select>
                            </div>
                            
                            <div class="source-a">
                                <label for="src-a-reg">Source A:</label>
                                <select id="src-a-reg">
                                    <option value="r0">r0</option>
                                    <option value="r1">r1</option>
                                    <option value="r2">r2</option>
                                    <option value="r3">r3</option>
                                    <option value="r4">r4</option>
                                    <option value="r5">r5</option>
                                    <option value="r6">r6</option>
                                    <option value="r7">r7</option>
                                    <option value="r8">r8</option>
                                    <option value="r9">r9</option>
                                    <option value="r10">r10</option>
                                    <option value="r11">r11</option>
                                    <option value="r12">r12</option>
                                    <option value="r13">r13</option>
                                    <option value="r14">r14</option>
                                    <option value="r15">r15</option>
                                    <option value="uniform">uniform</option>
                                    <option value="varying">varying</option>
                                    <option value="element">element</option>
                                    <option value="qpu_num">qpu_num</option>
                                </select>
                            </div>
                            
                            <div class="source-b">
                                <label for="src-b-reg">Source B:</label>
                                <select id="src-b-reg">
                                    <option value="r0">r0</option>
                                    <option value="r1">r1</option>
                                    <option value="r2">r2</option>
                                    <option value="r3">r3</option>
                                    <option value="r4">r4</option>
                                    <option value="r5">r5</option>
                                    <option value="r6">r6</option>
                                    <option value="r7">r7</option>
                                    <option value="r8">r8</option>
                                    <option value="r9">r9</option>
                                    <option value="r10">r10</option>
                                    <option value="r11">r11</option>
                                    <option value="r12">r12</option>
                                    <option value="r13">r13</option>
                                    <option value="r14">r14</option>
                                    <option value="r15">r15</option>
                                    <option value="uniform">uniform</option>
                                    <option value="varying">varying</option>
                                    <option value="element">element</option>
                                    <option value="qpu_num">qpu_num</option>
                                    <option value="immediate">immediate</option>
                                </select>
                                
                                <div id="immediate-value-container" style="display:none;">
                                    <label for="immediate-value">Immediate Value:</label>
                                    <input type="number" id="immediate-value" min="-2147483648" max="2147483647" value="0">
                                </div>
                            </div>
                        </div>
                        
                        <div class="condition-section">
                            <label for="condition">Condition:</label>
                            <select id="condition">
                                <option value="always">Always</option>
                                <option value="zero">Zero</option>
                                <option value="not-zero">Not Zero</option>
                                <option value="negative">Negative</option>
                                <option value="positive">Positive</option>
                                <option value="overflow">Overflow</option>
                                <option value="not-overflow">Not Overflow</option>
                                <option value="false">Never</option>
                            </select>
                        </div>
                    </div>
                    
                    <div id="branch-options" class="instruction-options" style="display:none;">
                        <div class="branch-section">
                            <label for="branch-cond">Branch Condition:</label>
                            <select id="branch-cond">
                                <option value="always">Always</option>
                                <option value="zero">Zero</option>
                                <option value="not-zero">Not Zero</option>
                            </select>
                            
                            <label for="branch-target">Branch Target:</label>
                            <input type="number" id="branch-target" min="0" max="4294967295" value="0">
                        </div>
                    </div>
                    
                    <div id="load-immediate-options" class="instruction-options" style="display:none;">
                        <div class="immediate-section">
                            <label for="li-dst">Destination Register:</label>
                            <select id="li-dst">
                                <option value="r0">r0</option>
                                <option value="r1">r1</option>
                                <option value="r2">r2</option>
                                <option value="r3">r3</option>
                                <option value="r4">r4</option>
                                <option value="r5">r5</option>
                                <option value="r6">r6</option>
                                <option value="r7">r7</option>
                                <option value="r8">r8</option>
                                <option value="r9">r9</option>
                                <option value="r10">r10</option>
                                <option value="r11">r11</option>
                                <option value="r12">r12</option>
                                <option value="r13">r13</option>
                                <option value="r14">r14</option>
                                <option value="r15">r15</option>
                            </select>
                            
                            <label for="li-value">Immediate Value:</label>
                            <input type="number" id="li-value" min="-2147483648" max="2147483647" value="0">
                        </div>
                    </div>
                    
                    <div id="load-options" class="instruction-options" style="display:none;">
                        <div class="load-section">
                            <label for="load-op">Load Operation:</label>
                            <select id="load-op">
                                <option value="ldvpm">Load from VPM (ldvpm)</option>
                                <option value="stvpm">Store to VPM (stvpm)</option>
                                <option value="ldtmu0">Load from TMU0 (ldtmu0)</option>
                                <option value="ldtmu1">Load from TMU1 (ldtmu1)</option>
                                <option value="lduniform">Load Uniform (lduniform)</option>
                                <option value="ldvary">Load Varying (ldvary)</option>
                            </select>
                            
                            <label for="load-dst">Destination Register:</label>
                            <select id="load-dst">
                                <option value="r0">r0</option>
                                <option value="r1">r1</option>
                                <option value="r2">r2</option>
                                <option value="r3">r3</option>
                                <option value="r4">r4</option>
                                <option value="r5">r5</option>
                                <option value="r6">r6</option>
                                <option value="r7">r7</option>
                                <option value="r8">r8</option>
                                <option value="r9">r9</option>
                                <option value="r10">r10</option>
                                <option value="r11">r11</option>
                                <option value="r12">r12</option>
                                <option value="r13">r13</option>
                                <option value="r14">r14</option>
                                <option value="r15">r15</option>
                            </select>
                        </div>
                    </div>
                    
                    <button id="assemble-btn">Assemble</button>
                </div>
                
                <textarea id="assembly-input" placeholder="Or type/paste assembly instruction here (e.g., 'add r0, r1, r2')"></textarea>
            </div>
            
            <div class="result-section">
                <h2>Binary Encoding</h2>
                <div class="binary-output">
                    <div class="word">
                        <span class="label">Word 0 (Hex):</span>
                        <span id="word0-hex" class="value">00000000</span>
                    </div>
                    <div class="word">
                        <span class="label">Word 1 (Hex):</span>
                        <span id="word1-hex" class="value">00000000</span>
                    </div>
                    <div class="combined">
                        <span class="label">Full Instruction (Hex):</span>
                        <span id="full-hex" class="value">0x00000000, 0x00000000</span>
                    </div>
                </div>
                
                <div class="instruction-breakdown">
                    <h3>Instruction Breakdown</h3>
                    <div id="instruction-details">
                        <p>Select options above or enter an assembly instruction to see details.</p>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="reference-section">
            <h2>QPU Instruction Reference</h2>
            <table id="instruction-reference">
                <thead>
                    <tr>
                        <th>Mnemonic</th>
                        <th>Opcode</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>nop</td>
                        <td>0x00</td>
                        <td>No operation</td>
                    </tr>
                    <tr>
                        <td>add</td>
                        <td>0x01</td>
                        <td>Addition</td>
                    </tr>
                    <tr>
                        <td>sub</td>
                        <td>0x02</td>
                        <td>Subtraction</td>
                    </tr>
                    <tr>
                        <td>mul</td>
                        <td>0x03</td>
                        <td>Multiplication</td>
                    </tr>
                    <tr>
                        <td>mov</td>
                        <td>0x1B</td>
                        <td>Move/copy</td>
                    </tr>
                    <tr>
                        <td>thrend</td>
                        <td>0xF0</td>
                        <td>Thread end</td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <!-- Add a new section for disassembly -->
        <div class="disassembler-panel">
            <h2>Disassembler</h2>
            <textarea id="disassembly-input" placeholder="Paste hex code here (e.g., '0x00101a00, 0xe0021c67')"></textarea>
            <button id="disassemble-btn">Disassemble</button>
            
            <div class="disassembly-results">
                <h3>Disassembled Code</h3>
                <pre id="disassembly-output"></pre>
            </div>
        </div>
    </div>
    
    <script src="scripts.js"></script>
</body>
</html>
